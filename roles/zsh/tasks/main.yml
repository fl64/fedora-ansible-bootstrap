- name: zsh | Install zsh
  block:
  - name: zsh | install zsh
    package:
      name: zsh
      state: latest
  - name: zsh | Set user shell
    user:
      name: "{{ lookup('env','USER') }}"
      shell: /usr/bin/zsh
  tags:
  - zsh

- name: zsh | Install oh-my-zsh
  become: false
  block:
  - name: zsh | Download zsh installer
    get_url:
      url: https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh
      dest: /tmp/zsh-installer.sh
      mode: 0755

  - name: zsh | Execute the zsh-installer.sh
    shell: /tmp/zsh-installer.sh
    args:
      creates: "/home/{{ lookup('env','USER') }}/.oh-my-zsh"

  - name: zsh | Remove the zsh-installer.sh
    file:
      path: /tmp/zsh-installer.sh
      state: absent

  - name: zsh | Install zsh-syntax-highlighting
    git:
      repo: https://github.com/zsh-users/zsh-syntax-highlighting
      dest: "/home/{{ lookup('env','USER') }}/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting"
      force: true
  - name: zsh | Install zsh-autosuggestions
    git:
      repo: https://github.com/zsh-users/zsh-autosuggestions
      dest: "/home/{{ lookup('env','USER') }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
      force: true
  # - name: zsh | Install zsh-kubectl-prompt
  #   git:
  #     repo: https://github.com/superbrothers/zsh-kubectl-prompt
  #     dest: "/home/{{ lookup('env','USER') }}/.oh-my-zsh/custom/plugins/zsh-kubectl-prompt"
  #     force: true
  # https://medium.com/@alex285/get-powerlevel9k-the-most-cool-linux-shell-ever-1c38516b0caa
  - name: zsh | Install powerlevel10k
    git:
      repo: https://github.com/romkatv/powerlevel10k.git
      dest: "/home/{{ lookup('env','USER') }}/.oh-my-zsh/custom/themes/powerlevel10k"
      force: true
  - name: zsh | Copy .zshrc config
    copy:
      src: "{{ item }}"
      dest: /home/{{ lookup('env','USER') }}/
      mode: 0644
    with_items:
    - .zshrc
    #- .zshrc_my
  tags:
  - zsh
  - oh-my-zsh
